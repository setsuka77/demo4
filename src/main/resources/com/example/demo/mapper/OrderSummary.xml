<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.OrderSummaryMapper">
	<insert id="addCart"
		parameterType="com.example.demo.entity.OrderSummary">
		INSERT INTO order_summary(product_id, quantity,
		unit_price, user_id,
		use_flag)
		VALUES(#{productId}, #{quantity},
		#{unitPrice}, #{userId}, #{useFlag})
	</insert>

	<select id="getTotalItemsForUser" parameterType="int"
		resultType="int">
		SELECT SUM(quantity)
		FROM order_summary
		WHERE user_id =
		#{userId} AND use_flag = 0
	</select>

	<select id="cartCheck"
		resultType="com.example.demo.entity.OrderSummary">
		SELECT
		os.id,
		os.order_id,
		os.product_id,
		os.quantity,
		os.unit_price,
		os.user_id,
		os.use_flag,
		g.product_name,
		g.image_url,
		sm.stock_quantity >= os.quantity AS is_stock_available
		FROM
		order_summary os
		INNER JOIN
		goods g
		ON
		os.product_id = g.product_id
		INNER
		JOIN
		stock_management sm
		ON
		os.product_id = sm.product_id
		WHERE
		os.user_id
		= #{userId};

	</select>


	<update id="updateCart"
		parameterType="com.example.demo.entity.OrderSummary">
		UPDATE order_summary
		SET quantity = quantity +
		#{quantity}
		WHERE product_id = #{productId}
		AND user_id = #{userId}
		AND
		use_flag = false;
	</update>




</mapper>