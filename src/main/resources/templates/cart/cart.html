<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>カート|たべたべ</title>
	<link rel="stylesheet" href="/demo/css/common.css">
	<link rel="stylesheet" href="/demo/css/product.css">
	<script src="/demo/js/cart.js" defer></script>
</head>

<body>
	<header th:replace="~{common/header :: header}"></header>
	<h1>カート</h1>

	<!-- カートに商品がある場合 -->
	<div th:if="${not #lists.isEmpty(cartList)}">
		<form id="cart" th:action="@{/cart/cart}" method="post">
			<div class="cart-item-container">
				<!-- 商品ごとにブロックを作成 -->
				<div th:each="cart : ${cartList}" class="cart-item" th:data-product-id="${cart.productId}">
					<div class="cart-item-image">
						<img th:src="@{/images/product/{imageName}(imageName=${cart.ImageUrl})}" alt="商品画像" width="100">
					</div>
					<div class="cart-item-details">

						<p class="cart-item-name" th:text="${cart.productName}"></p>
						<p class="price" th:text="${cart.unitPrice}" th:data-original-price="${cart.unitPrice}"> </p>
						<div class="stepper">
							<button type="button" class="decrement">ー</button>
							<input type="number" th:value="${cart.quantity}" min="1" class="stepper-input" readonly>
							<button type="button" class="increment">＋</button>
						</div>
						<a href="#" class="delete-link" th:data-product-id="${cart.productId}">削除</a>
						<p class="cart-item-price">
							小計:<span class="subtotal-price" th:text="${cart.quantity * cart.unitPrice}"></span>
						</p>
					</div>
					<div class="cart-item-actions">
						<!-- 在庫待ちメッセージ -->
						<span th:if="${cart.isStockAvailable != true}" style="color: red;">在庫待ち</span>
					</div>
				</div>
				<hr>

				<!-- 合計金額などの情報 -->
				<div class="order">
					<div class="order-row">
						<span>注文内容</span>
						<span id="totalNumber" th:text="${totalItems} + '件'"></span>
					</div>

					<hr>
					<div class="order-row">
						<span>商品合計</span>
						<span id="totalAmount">￥X,XXX</span>
					</div>
					<div class="order-row">
						<span>送料</span>
						<span>￥未定</span>
					</div>

					<!-- クーポン入力フォーム -->
					<div class="coupon-form">
						<span id="couponLabel">クーポン</span>
						<div class="coupon-input">
							<input type="text" id="couponCodeInput" name="couponCode" placeholder="クーポンコードを入力">
							<button type="button" name="action" value="applyCoupon">適用</button>
						</div>
					</div>

					<!-- 割引情報表示エリア -->
					<div class="discount-info"></div>

					<!-- 割引額表示用の行（最初は非表示） -->
					<div id="discountRow" class="order-row" style="display:none;">
						<span>割引</span>
						<span id="discount">
							<span id="discountText"></span>
							<a href="#" id="removeDiscount"
								style="margin-left: 10px; color: rgb(0, 128, 255); text-decoration: underline;">削除</a>
						</span>
					</div>


					<hr>
					<div class="order-row">
						<span>合計</span>
						<span id="totalWithDiscount">￥0</span>
					</div>
				</div>


				<button type="submit" name="confirm" class="product">購入手続きへ進む</button>

			</div>
		</form>
	</div>

	<!-- カートが空の場合 -->
	<div th:if="${#lists.isEmpty(cartList)}" class="cartNone">
		<p>カートに商品がありません。</p>
	</div>


	<!-- 削除確認ダイアログ -->
	<dialog class="dialog" id="confirmDialog" style="display:none;">
		<div class="dialog-content">

			<p>この商品を削除してもよろしいですか？</p>
			<button type="button" id="deleteBtn" data-product-id="${cart.productId}">削除</button>
			<button type="button" id="cancel">キャンセル</button>
		</div>
	</dialog>

</body>

</html>